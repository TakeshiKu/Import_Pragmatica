🧱 ИМПОРТ СТРУКТУРЫ ИЗДЕЛИЯ (LOGICAL STRUCTURE)

1. Назначение
   Папка используется для импорта структуры изделия (логистической структуры)
   в систему Pragmatica.
   Конвертация выполняется автоматически: из Excel-файла Structure.xlsx
   создаётся XML-файл structure_output.xml, который затем импортируется в проект.

──────────────────────────────────────────────────────────────

2. Состав папки
   convert_structure.bat        – запуск конвертации
   excel_to_xml_structure.py    – скрипт для преобразования Excel → XML
   Structure.xlsx               – рабочий файл структуры
   Template_Structure.xlsx      – шаблон-пример
   structure_output.xml         – результат (создаётся автоматически)
   README_ИмпортСтруктуры.txt   – это руководство

──────────────────────────────────────────────────────────────

3. Формат Excel-файла
   Файл Structure.xlsx должен содержать лист "Структура" со следующими колонками:

     • Item_ID       – уникальный код элемента (например, МПС)
     • Parent_ID     – код родительского элемента (если пусто — это корень)
     • Name          – наименование элемента
     • Description   – описание элемента (необязательно)

Поле Description сохраняется в XML-файле, но не отображается в интерфейсе Pragmatica,
потому что в текущей версии программы это поле не выводится в карточке функции.

     • Quantity      – количество в составе родителя
     • UOM           – единица измерения (обычно "Н")
                       Важно: значение "Н" используется как техническая заглушка.
                       Это не физическая единица (не ньютон). Указывается для
                       корректности структуры XML.

   Название листа должно быть строго "Структура" (без кавычек и пробелов).

──────────────────────────────────────────────────────────────

4. Пример строк

   Item_ID,                 Parent_ID,                     Name,                          Description,                  Quantity, UOM
   -----------------------------------------------------------------------------------------------------------------------------
   МПС,                     ,                              Модуль передачи сигналов,      структурный клон ЛСИ МПС,     1,        Н
   1 - Блок приема,         МПС,                           ,                              ,                              1,        Н
   АнтеннаВХ,               1 - Блок приема,               ,                              ,                              1,        Н
   Фильтр,                  1 - Блок приема,               ,                              ,                              1,        Н
   2 - Блок обработки сигналов, МПС,                       ,                              ,                              1,        Н
   ДешифраторВЫХ,           2 - Блок обработки сигналов,   ,                              ,                              1,        Н
   Коммутатор,              2 - Блок обработки сигналов,   ,                              ,                              1,        Н
   АЦП,                     2 - Блок обработки сигналов,   ,                              ,                              1,        Н
   МК,                      2 - Блок обработки сигналов,   Микроконтроллер,              ,                              1,        Н
   3 - Блок передачи,       МПС,                           ,                              ,                              1,        Н
   Усилитель,               3 - Блок передачи,             ,                              ,                              1,        Н
   АнтеннаВЫХ,              3 - Блок передачи,             ,                              ,                              1,        Н
   БП 2,                    МПС,                           блок питания,                 ,                              1,        Н
   БП 1,                    МПС,                           блок питания,                 ,                              1,        Н

──────────────────────────────────────────────────────────────

5. Порядок действий
   1) Открой файл Structure.xlsx и заполни лист "Структура".
      Не меняй название листа и не удаляй заголовки колонок.
   2) Сохрани файл и закрой Excel.
   3) Запусти convert_structure.bat (дважды кликни).
   4) После завершения появится сообщение:
        "XML сохранён: structure_output.xml".
   5) В папке появится (или обновится) файл structure_output.xml.
      При каждом запуске он перезаписывается.

──────────────────────────────────────────────────────────────

6. Импорт в Pragmatica
   1) Открой нужный проект.
   2) Встань на ФИ, под который нужно добавить структуру.
   3) Выбери пункт меню: Импорт → Логистической структуры.
   4) Укажи файл structure_output.xml.
   5) После импорта структура появится в разделе "Результаты импорта".
   6) Чтобы связать её с ФИ:
        – открой свойства импортированного объекта;
        – в поле "Анализируемый объект" выбери нужный ФИ (например, ТЕСТ);
        – нажми "Сохранить".

──────────────────────────────────────────────────────────────

7. Типичные ошибки

   • Parent_ID не найден
     → Указан родитель, которого нет в списке. Проверь названия элементов.

   • Импорт прошёл, но структура не под ФИ
     → Нужно вручную задать "Анализируемый объект".

   • XML повреждён
     → Изменены заголовки или название листа. Верни оригинальные имена.

   • Дублируются ветки
     → Повторный импорт без очистки. Удали старые результаты.

──────────────────────────────────────────────────────────────

8. Полезно знать
   • Файл structure_output.xml при каждом запуске перезаписывается.
   • Можно добавить в XML привязку к ФИ вручную:
       <Dataset GUID="urn:placeholder" parentfi="ТЕСТ">
   • Если планируется несколько импортов, храни отдельные файлы Excel по каждому ФИ.

──────────────────────────────────────────────────────────────

9. Требования к окружению
   Для работы конвертации требуется установленный Python 3 и библиотеки:

       pip install pandas openpyxl

   Проверка установки:
       python --version

   Если команда не найдена — установи Python с сайта:
       https://www.python.org/downloads/
   и при установке отметь галочку:
       "Add Python to PATH"

   После этого все .bat-файлы будут работать автоматически.