⚙️ ИМПОРТ ФУНКЦИЙ В PRAGMATICA

1. НАЗНАЧЕНИЕ
Используется для подготовки и загрузки функций в систему Pragmatica.

Инструмент:
– извлекает функции из исходного документа (Word / PDF / Excel / TXT);
– формирует Excel-файл по шаблону;
– конвертирует его в XML для импорта в Pragmatica.

Работа идёт через окно «Импорт функций в Pragmatica» (GUI).
Поддерживаются два режима:
– Функции ФИ (иерархия по коду);
– Функции систем (плоский список).

───────────────────────────────
2. СТРУКТУРА ПАПКИ «ФУНКЦИИ»

В корневой папке находятся:

• ЗАПУСК.bat
  – запуск графического интерфейса.

• README_ИмпортФункций.txt
  – это руководство.

• Результаты_EXCEL
  – сюда сохраняется Functions.xlsx;
  – сюда же складываются резервные копии (подпапка «Архив»).

• Результаты_XML
  – сюда сохраняется functions_output.xml;
  – сюда же складываются резервные копии (подпапка «Архив»).

• Шаблон
  – файл Template_Functions.xlsx (образец формата для ручной доработки).

• Служебные файлы
  – GUI.py
  – parse_functions.py
  – excel_to_xml_functions.py
  – служебные .bat-файлы, если используются отдельно.

Логотип (если есть) находится уровнем выше, в папке:
…\ImportPragmatica\logo\logo.png / logo.ico

───────────────────────────────
3. АВТОМАТИЧЕСКИЕ ФАЙЛЫ

При каждом запуске импорта через GUI создаются / обновляются:

• Результаты_EXCEL\Functions.xlsx
  – таблица функций, подготовленная к импорту.

• Результаты_XML\functions_output.xml
  – итоговый XML для загрузки в Pragmatica.

Перед перезаписью:
– старая версия Functions.xlsx переносится в
  Результаты_EXCEL\Архив\Functions_ГГГГММДД_ЧЧММСС.xlsx;
– старая версия functions_output.xml переносится в
  Результаты_XML\Архив\functions_output_ГГГГММДД_ЧЧММСС.xml.

───────────────────────────────
4. ГРАФИЧЕСКИЙ ИНТЕРФЕЙС

Запуск:
– запусти ЗАПУСК.bat (рекомендуемый вариант), либо
– запусти GUI.py из папки «Служебные файлы» через Python.

Поля и настройки:

• Файл
  Исходный документ с функциями:
  – .docx
  – .pdf
  – .xlsx / .xls
  – .txt

• ФИ
  Обозначение функционального экземпляра, как в проекте Pragmatica.
  Подсказка справа: «Как в Проекте АН».

• Требуемый уровень вложенности
  Переключатель 0–5.
  – 0 — вся глубина (все уровни кода);
  – 1 — только верхний уровень (F0, F1, F2, Ф0, Ф1 и т.д.);
  – 2–5 — ограничение по глубине (F1.2, F1.2.3 и т.п.).
  Подсказка: «0 = вся глубина».

• Тип функций
  – «Функции ФИ» — строится иерархия по коду (Parent_LCN вычисляется автоматически);
  – «Функции систем» — плоский список, Parent_LCN оставляется пустым.

• Буква кода
  – «Любая» — не фильтровать по букве;
  – «F» — брать только коды, начинающиеся на F;
  – «Ф» — брать только коды, начинающиеся на Ф.
  Латинская F и кириллическая Ф различаются.

• Числовая часть начинается с
  Фильтр по первой числовой группе после буквы:
  – пусто — без фильтра;
  – «1»  — взять коды, где первая группа ≥ 1 (1, 2, 3, 10, 21…);
  – «20» — взять коды, где первая группа ≥ 20 (20, 21, 22, 99…).

Кнопка «▶ Запустить импорт»:
1) анализирует файл и создаёт/обновляет Результаты_EXCEL\Functions.xlsx;
2) конвертирует его в Результаты_XML\functions_output.xml.

Если функций не найдено или произошла ошибка, XML не создаётся,
в лог и в диалог выводится понятное сообщение.

───────────────────────────────
5. СОДЕРЖИМОЕ FUNCTIONS.XLSX

Файл сохраняется в:
  Результаты_EXCEL\Functions.xlsx
Лист: «Функции».

Обязательные столбцы:

• FI_Обозначение
  Обозначение ФИ, под который загружаются функции.
  Примеры: ТЕСТ, МС-21, Л1.

• Func_LCN
  Уникальный код функции: буква + уровни через точку:
  – F1
  – F1.2
  – F5.2.1.3.2
  Префикс ФИ сюда НЕ включается.
  Правильно:  F5.2.1.3.2
  Неправильно: ТЕСТ-F5.2.1.3.2

• Parent_LCN
  – для режима «Функции ФИ» заполняется автоматически скриптом;
  – для режима «Функции систем» может быть пустым у всех строк.

• Name
  Наименование функции.

• Description
  Описание функции (опционально).

• Products_List
  Список связанных элементов структуры изделия через запятую (опционально).
  Связи создаются только если в проекте уже есть структура изделия,
  а обозначения элементов совпадают с указанными в этом столбце.

───────────────────────────────
6. ИМПОРТ В PRAGMATICA

1) Подготовь файл через GUI (см. раздел 4).
2) Убедись, что есть файл:
   Результаты_XML\functions_output.xml
3) В Pragmatica открой нужный проект.
4) Выбери ФИ, для которого загружаются функции.
5) Запусти команду «Импорт XML» и укажи functions_output.xml.
6) Проверь дерево функций после импорта.

───────────────────────────────
7. ТИПИЧНЫЕ СИТУАЦИИ И ОШИБКИ

• ФИ не найден при импорте в Pragmatica
  – FI_Обозначение не совпадает с кодом ФИ в проекте.

• Ошибка: отсутствует колонка
  – в листе «Функции» нет одного из обязательных столбцов.

• Ошибка: дубликат Func_LCN
  – в таблице две строки с одинаковым кодом функции.

• Ошибка: несуществующий Parent_LCN
  – указан родитель, которого нет в Func_LCN.

• XML не создан
  – комбинированные фильтры (буква / числовая часть / глубина / тип)
    отобрали 0 функций;
  – при генерации Excel или XML возникла ошибка, смотри лог в окне.

